<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Design Friction for LLM Writing</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f9f9f9;
      margin: 0;
    }

    h1 { margin: 32px 0; }

    .participant-form {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      text-align: center;
      min-width: 400px;
    }

    .form-group { margin-bottom: 20px; }

    label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    input[type="text"]:focus, input[type="number"]:focus { outline: none; border-color: #007BFF; }

    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
      background-color: white;
    }

    select:focus { outline: none; border-color: #007BFF; }

    .btn {
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s;
    }

    .btn:hover { background-color: #0056b3; }
    .btn:disabled { background-color: #ccc; cursor: not-allowed; }

    .study-links { display: none; }
    .study-links.show { display: block; }

    ul { list-style: none; padding: 0; }
    li { margin: 15px 0; list-style: none; }

    a {
      text-decoration: none;
      color: #007BFF;
      font-size: 18px;
      transition: all 0.2s ease;
      display: inline-block;
      padding: 10px 16px;
      border-radius: 6px;
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      min-width: 280px;
      text-align: left;
    }

    a:hover {
      color: #0056b3;
      background-color: #e7f3ff;
      border-color: #007BFF;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
    }

    .participant-info {
      background: #e8f5e8;
      border: 1px solid #4caf50;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      text-align: center;
    }

    .change-id { background: none; border: none; color: #007BFF; cursor: pointer; text-decoration: underline; font-size: 14px; }
  </style>
</head>
<body>

  <h1>Welcome to the LLM Writing Study</h1>

  <!-- Participant ID Form -->
  <div id="participantForm" class="participant-form">
    <div class="form-group">
      <input type="number" id="participantId" placeholder="Enter your participant ID" required>
    </div>
    
    <!-- <div class="form-group">
      <label for="experimentCondition">Condition:</label>
      <select id="experimentCondition" required>
        <option value="">Select a Condition...</option>
        <option value="0">A, B, H, C, G, D, F, E</option>
        <option value="1">B, C, A, D, H, E, G, F</option>
        <option value="2">C, D, B, E, A, F, H, G</option>
        <option value="3">D, E, C, F, B, G, A, H</option>
        <option value="4">E, F, D, G, C, H, B, A</option>
        <option value="5">F, G, E, H, D, A, C, B</option>
        <option value="6">G, H, F, A, E, B, D, C</option>
        <option value="7">H, A, G, B, F, C, E, D</option>
      </select>
    </div> -->
    
    <button class="btn" id="continueBtn">Continue</button>
  </div>

  <!-- Study Links (hidden initially) -->
  <div id="studyLinks" class="study-links">
    <div class="participant-info">
      <strong>Participant ID:</strong> <span id="displayParticipantId"></span><br>
      <!-- <strong>Condition:</strong> <span id="displayCondition"></span> -->
      <button class="change-id" onclick="changeParticipantId()">Change ID</button>
    </div>

    <ul id="taskList"></ul>
  </div>

  <script>
  // Latin square rows (Phase 1 only)
  const LATIN_SQUARE = [
    ['A','B','H','C','G','D','F','E'],
    ['B','C','A','D','H','E','G','F'],
    ['C','D','B','E','A','F','H','G'],
    ['D','E','C','F','B','G','A','H'],
    ['E','F','D','G','C','H','B','A'],
    ['F','G','E','H','D','A','C','B'],
    ['G','H','F','A','E','B','D','C'],
    ['H','A','G','B','F','C','E','D'],
  ];

  // Hash any string to a 0..7 column index; if numeric, use (n-1) % 8
  function idToCol(idStr){
    const n = Number(idStr);
    if(Number.isFinite(n)){
      return ((Math.floor(n) - 1) % 8 + 8) % 8;
    }
    // simple string hash
    let h = 0;
    for(let i=0;i<idStr.length;i++) h = (h*31 + idStr.charCodeAt(i))|0;
    return ((h % 8) + 8) % 8;
  }

  function phase1ConditionFor(rowIndex, participantId) {
    const col = idToCol(participantId);
    return LATIN_SQUARE[rowIndex][col];
  }

  document.addEventListener('DOMContentLoaded', () => {
    const storedId = localStorage.getItem('participant_id');
    const storedRow = localStorage.getItem('phase1_row');
    const storedCondition = localStorage.getItem('phase1_condition');
    if (storedId && storedRow !== null && storedCondition) {
      showStudyLinks(storedId, Number(storedRow), storedCondition);
    }

    document.getElementById('continueBtn').addEventListener('click', setParticipantId);
    
    // Allow Enter key to submit
    document.getElementById('participantId').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        setParticipantId();
      }
    });
  });

  function setParticipantId() {
    try{
      const idEl = document.getElementById('participantId');
      const participantId = (idEl.value || '').trim();

      if (!participantId) {
        alert('Please enter a participant ID');
        return;
      }

      // Auto-calculate row index from participant ID
      const rowIndex = idToCol(participantId); // This gives us 0-7 based on participant ID
      const cond = phase1ConditionFor(rowIndex, participantId);

      ['participant_id','participant_start_time','phase1_row','phase1_condition'].forEach(key => localStorage.removeItem(key));

      localStorage.setItem('participant_id', participantId);
      localStorage.setItem('phase1_row', String(rowIndex));
      localStorage.setItem('phase1_condition', cond);
      localStorage.setItem('participant_start_time', new Date().toISOString());

      showStudyLinks(participantId, rowIndex, cond);
    }catch(err){
      console.error('Continue failed:', err);
      alert('An error occurred. Please check the console for details.');
    }
  }

  function showStudyLinks(participantId, rowIndex, phase1Condition) {
    document.getElementById('participantForm').style.display = 'none';
    document.getElementById('studyLinks').classList.add('show');
    document.getElementById('displayParticipantId').textContent = participantId;
    // Note: Condition display is commented out in HTML, so we don't need to set it
    generateTaskList(phase1Condition);
  }

  function generateTaskList(phase1Condition) {
    const taskList = document.getElementById('taskList');
    taskList.innerHTML = '';

    // Get the stored row index for the participant ID parameter
    const rowIndex = localStorage.getItem('phase1_row');
    const participantId = localStorage.getItem('participant_id');
    
    const links = [
      `<li><a href="https://uwaterloo.ca1.qualtrics.com/jfe/form/SV_bHhEXxbTZX7pVaK" target="_blank">üìã Pre-Questionnaire</a></li>`,
      `<li><a href="phase1.html?pid=${rowIndex}" target="_blank">‚úçÔ∏è Task 1</a></li>`,
      `<li><a href="https://uwaterloo.ca1.qualtrics.com/jfe/form/SV_3jv5E9hMrwBemHA" target="_blank">üìã Post-Questionnaire-Task 1</a></li>`,
      `<li><a href="phase2.html" target="_blank">üßÆ Task 2</a></li>`,
      `<li><a href="https://uwaterloo.ca1.qualtrics.com/jfe/form/SV_9Riw80U7jj7891k" target="_blank">‚úçÔ∏è Task 3</a></li>`,
    ];

    taskList.innerHTML = links.join('');
  }

  function changeParticipantId() {
    document.getElementById('participantForm').style.display = 'block';
    document.getElementById('studyLinks').classList.remove('show');
    document.getElementById('participantId').value = '';
    document.getElementById('participantId').focus();
  }
</script>

</body>
</html>
